@page "/"
@page "/location/"
@page "/location/{locationId}"

@using Blazorise
@using ClimateExplorer.Core.DataPreparation
@using Blazorise.SpinKit
@using static ClimateExplorer.Visualiser.UiModel.SuggestedPresetLists;
@using static ClimateExplorer.Visualiser.Shared.Collapsible;

<PageTitle>@GetPageTitle()</PageTitle>

<div style="flex-grow: 0">
    <Collapsible Title="Suggested charts" InitiallyShown="false" ShowTitleWhenExpanded="false" ContentLayoutType="CollapserContentLayoutTypes.FlexboxRow">
        <Content>
            <SuggestedCharts DataSetDefinitions="@DataSetDefinitions" SelectedLocation="@SelectedLocation" OnChartPresetSelected="@OnChartPresetSelected" ExpandUpwards="false" PresetType="PresetTypes.Location"></SuggestedCharts>
        </Content>
    </Collapsible>
</div>

<div class="location-and-chart-container">
    @if (ShowLocation)
    {
        <div>
            <div class="map-space-reserver" id="mapContainerContainer">
                <MapContainer @ref="mapContainer"
                    Locations="@Locations"
                    OnLocationChange="@SelectedLocationChanged"
                    LocationCoordinates="@LocationCoordinates"></MapContainer>
            </div>

            <div class="location-info-container">
                <LocationInfo @ref="locationInfoComponent"
                            Location="@SelectedLocation"
                            DataSetDefinitions="@DataSetDefinitions"
                            RequestLocationChange="@ShowSelectLocationModal"
                            OnOverviewShowOrHide="@OnOverviewShowHide"
                            OnYearFilterChange="@HandleOnYearFilterChange" />
            </div>

            <div style="clear: both;"></div>
        </div>
    }


    <ChartView @ref="chartView"
               BuildDataSetsEvent="@BuildDataSets"
               ShowAddDataSetModalEvent="@ShowAddDataSetModal"
               DownloadDataEvent="@OnDownloadDataClicked" />
</div>

<SelectLocation @ref="selectLocationModal"
                Locations="@Locations"
                SelectedLocation="@SelectedLocation"
                OnLocationChange="@SelectedLocationChanged"
                SetCurrentLocation=@SetCurrentLocation
                BrowserLocationErrorMessage=@BrowserLocationErrorMessage />

<Modal @ref="addDataSetModal">
    <ModalContent>
        <ModalHeader Background="Background.Light">
            <ModalTitle>Add data set</ModalTitle>
            <CloseButton />
        </ModalHeader>
        <ModalBody>
            <DataSetBrowser DataSetDefinitions="@DataSetDefinitions" OnAddDataSet="@OnAddDataSet" CurrentLocation="@SelectedLocation" PreviousLocation="@PreviousLocation"></DataSetBrowser>
        </ModalBody>
    </ModalContent>
</Modal>