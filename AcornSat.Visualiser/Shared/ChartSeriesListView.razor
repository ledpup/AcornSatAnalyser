@using AcornSat.Visualiser.UiModel
@using Blazorise
@using Blazorise.Components
@using Blazorise.Charts

<Collapsible Title="Datasets">
    <Content>
        @foreach (var cs in ChartSeriesList)
        {
            <ChartSeriesView 
                ChartSeries="@cs" 
                OnSeriesChanged="@OnSeriesChangedInternal"
                OnDuplicateSeries="@OnDuplicateSeries"
                OnRemoveSeries="@OnRemoveSeries"
                ></ChartSeriesView>
        }
    </Content>
</Collapsible>

@code {
    [Parameter]
    public List<ChartSeriesDefinition> ChartSeriesList { get; set; }

    [Parameter]
    public EventCallback OnSeriesChanged { get; set; }

    async Task OnSeriesChangedInternal()
    {
        await OnSeriesChanged.InvokeAsync();
    }

    async Task OnRemoveSeries(ChartSeriesDefinition csd)
    {
        ChartSeriesList.Remove(csd);

        OnSeriesChangedInternal();
    }

    async Task OnDuplicateSeries(ChartSeriesDefinition csd)
    {
        ChartSeriesList.Add(
            new ChartSeriesDefinition()
            {
                Aggregation = csd.Aggregation,
                DataResolution = csd.DataResolution,
                DataSetDefinition = csd.DataSetDefinition,
                LocationId = csd.LocationId,
                LocationName = csd.LocationName,
                MeasurementDefinition = csd.MeasurementDefinition,
                Smoothing = csd.Smoothing,
                SmoothingWindow = csd.SmoothingWindow,
                Value = csd.Value,
                Year = csd.Year
            }
        );

        OnSeriesChangedInternal();
    }
}
